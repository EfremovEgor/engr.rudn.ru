{% extends "components/base.html" %}
{% load static i18n %}
{% get_current_language as LANGUAGE_CODE %}
{% block content %}

<script src="{% static 'js/seminars.js' %}"></script>
<link rel="stylesheet" href="{% static 'css/academy/departments.css' %}">
<link rel="stylesheet" href="{% static 'css/seminars.css' %}">

<div class="uk-container">
  <a href="{% url 'pages:science_events' %}" class="return-button">{% trans "Научные мероприятия" %}</a>
  <a href="{% url 'seminars:seminars_list' %}" class="return-button" style="margin-top:50px;margin-left:15px;">{% trans "Научные семинары" %}</a>

  <div class="page-name">
    {% if LANGUAGE_CODE == 'en' and seminar.name_en %}
      {{ seminar.name_en }}
    {% else %}
      {{ seminar.name }}
    {% endif %}
  </div>
</div>

<div class="uk-container" style="margin-top:20px;margin-bottom:50px">

  <div class="seminar-description uk-margin" style="margin-top:-10px;">
    {% trans "Семинар проводится в рамках" %}

    <a href="/academy/departments/{{ seminar.department.abbreviation|get_url_department_abbreviation }}">
      {% if LANGUAGE_CODE == 'en' and seminar.department.name_en %}
        {{ seminar.department.name_en|slice:"8:50" }}
      {% else %}
        кафедры {{ seminar.department.name|slice:"8:50" }}
      {% endif %}
    </a>.

    <span style="margin-top:-20px;text-align:justify;">
      {% if LANGUAGE_CODE == 'en' and seminar.description_en %}
        {{ seminar.description_en|safe }}
      {% else %}
        {{ seminar.description|safe }}
      {% endif %}
    </span>
  </div>

  <h2 class="sub-heading">{% trans "Председатель" %}</h2>
  {# ——— блок председателя без изменений, ФИО остаётся на русском ——— #}

  <h2 class="sub-heading">{% trans "Доклады" %}</h2>

  <div style="margin-left:20px">
    <ul uk-accordion>
      <li class="uk-open">
        <a class="uk-accordion-title" href>{% trans "Предстоящие" %}</a>
        <div class="uk-accordion-content" style="margin-left:20px;margin-top:10px;display:flex;flex-direction:column;gap:5px">
          {% if upcoming_reports|length == 0 %}
            {% trans "Предстоящие доклады не запланированы" %}
          {% endif %}

          {% for report in upcoming_reports %}
            {% if not report.is_past_due %}
              <div>
                <div class="uk-card uk-card-default uk-card-hover uk-card-body">
                  <div class="uk-card-badge uk-label">
                    {{ report.date_start|date:"j/m/o" }} {{ report.time_start|date:"H:i" }}
                  </div>

                  <h3 class="uk-card-title uk-margin-remove">
                    <a class="uk-link-reset" href="/science/seminars/{{ seminar.id }}/reports/{{ report.id }}">
                      {% if LANGUAGE_CODE == 'en' and report.name_en %}
                        {{ report.name_en }}
                      {% else %}
                        {{ report }}
                      {% endif %}
                    </a>
                  </h3>

                  <h4 class="uk-margin-remove">
                    {{ report.speaker.last_name }} {{ report.speaker.first_name }} {{ report.speaker.middle_name }}
                  </h4>

                  <ul class="uk-comment-meta uk-list-collapse uk-list uk-margin-remove-top">
                    {% for title in report.speaker.job_title %}
                      <li>{{ title }}</li>
                    {% endfor %}
                    {% if report.speaker.academic_degree %}
                      <li>{{ report.speaker.academic_degree }}</li>
                    {% endif %}
                    {% if report.speaker.academic_title %}
                      <li>{{ report.speaker.academic_title }}</li>
                    {% endif %}
                  </ul>

                  <a href="/science/seminars/{{ seminar.id }}/reports/{{ report.id }}"
                     class="link-hover-underline red-link-hover-underline">
                    <span class="show-uni-department__link-text">{% trans "Подробнее" %}</span>
                    <i class="icon-ic_arrow"></i>
                  </a>
                </div>
              </div>
            {% endif %}
          {% endfor %}
        </div>
      </li>

      <li>
        <a class="uk-accordion-title" href>{% trans "Прошедшие" %}</a>
        <div class="uk-accordion-content" style="margin-left:20px;margin-top:10px;display:flex;flex-direction:column;gap:5px">
          {% if past_reports|length == 0 %}
            {% trans "Прошедшие доклады отсутствуют" %}
          {% endif %}

          {% for report in past_reports %}
            {% if report.is_past_due %}
              <div>
                <a class="uk-link-muted"
                   href="/science/seminars/{{ seminar.id }}/reports/{{ report.id }}">
                   {{ report.date_start|date:"o.m.d" }} «
                   {% if LANGUAGE_CODE == 'en' and report.name_en %}
                     {{ report.name_en }}
                   {% else %}
                     {{ report }}
                   {% endif %} »
                   ({{ report.speaker.last_name }} {{ report.speaker.first_name.0 }}.{% if report.speaker.middle_name %}{{ report.speaker.middle_name.0 }}.{% endif %})
                </a>
              </div>
            {% endif %}
          {% endfor %}
        </div>
      </li>
    </ul>
  </div>
</div>
{% endblock %}
